---
import { useLocale } from '@utils/locale'

const { url } = Astro
const { path, t, locale } = useLocale(url)

const items = ['tags']

// function to check if current page is root/posts page
function isRootPage() {
  return (
    url.pathname === '/' ||
    url.pathname === '/zh/' ||
    url.pathname === '/en/' ||
    url.pathname.includes('/posts/') ||
    url.pathname.includes('/tags/')
  )
}

// detect current language from URL
function getCurrentLanguage() {
  if (url.pathname.startsWith('/en/')) return 'en'
  if (url.pathname.startsWith('/zh/')) return 'zh'
  if (url.pathname === '/') return 'zh' // root path is Chinese
  return 'zh' // default
}

const currentLang = getCurrentLanguage()

// get the correct home URL based on current language
function getHomeUrl() {
  if (currentLang === 'en') return '/en/'
  if (url.pathname === '/') return '/' // stay on root for Chinese
  return '/zh/'
}
---

<nav>
  <a
    href={getHomeUrl()}
    class="nav-link mr-4 animated hover:no-underline"
    class:list={isRootPage() ? "active" : ""}>{t("nav.posts")}</a
  >
  {
    items.map((item) => {
      // 根据当前页面路径决定链接格式
      let itemUrl
      if (currentLang === 'en') {
        itemUrl = `/en/${item}/`
      } else if (url.pathname === '/' || url.pathname.startsWith('/tags/') || url.pathname.startsWith('/projects/')) {
        // 根路径或已经在根级别的页面，保持根级别链接
        itemUrl = `/${item}/`
      } else {
        // 其他中文页面使用 /zh/ 前缀
        itemUrl = `/zh/${item}/`
      }
      
      return (
        <a
          href={itemUrl}
          class="nav-link mr-4 animated hover:no-underline"
          class:list={url.toString().includes(item) ? "active" : ""}
        >
          {t(`nav.${item}`)}
        </a>
      );
    })
  }
</nav>
