---
import '../styles/index.css'
import { useLocale } from '@utils/locale'
import Header from './Header.astro'
import Navbar from './Navbar.astro'
import '@fontsource/ibm-plex-sans'
import { SEO } from 'astro-seo'
import Footer from './Footer.astro'

const { t, locale } = useLocale(Astro.url)

export const prerender = true

export interface Props {
  title: string | undefined
  navbar?: boolean
  description?: string
}

let { title, navbar, description } = Astro.props
if (navbar === undefined) navbar = true
if (!description) description = t('layout.description')
const fullTitle = `${title} - ${t('layout.title')}`
---

<!doctype html>
<html lang="en" class="mx-4">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
    <link rel="preload" href="/src/styles/index.css" as="style" />
    <style>
      /* Critical CSS - Above the fold styles */
      body { font-family: "IBM Plex Sans", sans-serif; margin: 0; }
      .max-width { max-width: 800px; margin: 0 auto; }
      nav { display: flex; align-items: center; }
    </style>
    <title>{fullTitle}</title>
    <SEO
      title="Kratos's Blog"
      description="A place sharing a life of a software engineer"
      openGraph={{
        basic: {
          title: "Kratos's Blog",
          type: "Blog",
          image: "https://avatars.githubusercontent.com/u/63009984?v=4",
        },
      }}
      twitter={{
        creator: "@kratosmy_",
      }}
    />
  </head>
  <body class="max-width dark:bg-[#333] bg-[#FBFBFBFF]">
    <Header />
    {navbar && <Navbar />}
    <main>
      <slot />
    </main>
    <Footer />
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('SW registered: ', registration);
            })
            .catch((registrationError) => {
              console.log('SW registration failed: ', registrationError);
            });
        });
      }
    </script>
</html>
